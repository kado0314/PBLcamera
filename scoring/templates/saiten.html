<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <title>ファッション採点</title>
    <link rel="stylesheet" href="../../static/css/fashion.css">
    <link rel="icon" href="https://github.com/kado0314/PBLcamera/blob/main/static/image/huku.png?raw=true" type="image/png">
</head>
<body>
    <h1>ファッション採点</h1>
    <form method="POST" enctype="multipart/form-data" action="{{ url_for('scoring.saiten') }}">
        
        <label>画像をアップロード</label><br>
        <input type="file" name="image_file" accept="image/*" capture="camera" id="imageInput"><br><br>

        <img id="imagePreview" src="" style="max-width:300px; display: none; margin-bottom: 10px;"><br>

        <label for="user_gender">性別</label><br>
        <select name="user_gender" id="user_gender">
            <option value="neutral" {% if selected_gender == 'neutral' %}selected{% endif %}>指定なし (Neutral)</option>
            <option value="male" {% if selected_gender == 'male' %}selected{% endif %}>男性 (Male)</option>
            <option value="female" {% if selected_gender == 'female' %}selected{% endif %}>女性 (Female)</option>
        </select>
        <br><br>

        <label for="intended_scene">TPO (シーン)</label><br>
        <select name="intended_scene" id="intended_scene">
            <option value="date" {% if selected_scene == 'date' %}selected{% endif %}>デート</option>
            <option value="work" {% if selected_scene == 'work' %}selected{% endif %}>仕事</option>
            <option value="friends" {% if selected_scene == 'friends' %}selected{% endif %}>友達と遊ぶ</option>
            </select>
        <br><br>

        <button type="submit">採点する</button>
    </form>

    {% if uploaded_image_data %}
    <hr>
    <div class="target">
        <h3>採点対象</h3>
        <img src="{{ uploaded_image_data }}" style="max-width:300px;">
    </div>
    {% endif %}

    {% if score is not none %}
    <hr>
    <div class="results">
        <h2>採点結果: {{ score }} 点</h2>
        <p>{{ recommendation }}</p>
        <ul>
            {% for f in feedback %}
                <li>{{ f }}</li>
            {% endfor %}
        </ul>
    </div>
    {% endif %}
    {% if radar_chart_data %}
    <hr>
    <div class="chart">
        <h3>スコアチャート</h3>
        <img src="{{ radar_chart_data }}" alt="レーダーチャート" style="max-width:400px;">
    </div>
    {% endif %}
    <script>
    // 1. ファイル選択フィールドとプレビュー要素を取得
        const imageInput = document.getElementById('imageInput');
        const imagePreview = document.getElementById('imagePreview');

    // 2. ファイルが選択されたときのイベントリスナーを設定
        imageInput.addEventListener('change', function(event) {
        // 選択されたファイルを取得
            const file = event.target.files[0];
        
            if (file) {
            // ファイルリーダーを作成し、ファイルの内容を読み込む
                const reader = new FileReader();
            
                reader.onload = function(e) {
                // 読み込み完了後、プレビュー要素のsrc属性に設定
                    imagePreview.src = e.target.result;
                // プレビュー要素を表示状態にする
                    imagePreview.style.display = 'block';
                };
            
            // ファイルをData URL (Base64) として読み込む
                reader.readAsDataURL(file);
            } else {
            // ファイル選択がキャンセルされた場合、プレビューを非表示にする
                imagePreview.src = '';
                imagePreview.style.display = 'none';
            }
        });
    </script>
</body>
</html>





